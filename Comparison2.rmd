---
title: "R Notebook"
output: html_notebook
---
Check number of the output states matched using a not fully connected model.
```{r}
set.seed(1234)
n_states = 5
n_time = 200


#tran.m.true <- matrix(unlist(x1), ncol = n_states, byrow = T)
#apply(tran.m, 1, sum)
tran.m.true <- matrix(c(1/2, 1/2, 0, 0, 0,
                        1/3, 1/3, 1/3, 0, 0,
                        0, 1/3, 1/3, 1/3, 0, 
                        0, 0, 1/3, 1/3, 1/3, 
                        0, 0, 0, 1/2, 1/2), byrow=TRUE, nrow=5)
listofnormals = list()
listofnormals[[1]] = list(1, 'mean' = 2, 'sd' = 1 )
listofnormals[[2]] = list(1, 'mean' = 4, 'sd' = 3 )
listofnormals[[3]] = list(1, 'mean' = 8, 'sd' = 3 )
listofnormals[[4]] = list(1, 'mean' = 14, 'sd' = 3 )
listofnormals[[5]] = list(1, 'mean' = 10, 'sd' = 4 )
ini.vec = c(1, 0, 0, 0,0)
obs.vec = rep(NA, n_time)
obs.states = rep(NA, n_time)

for (i in 1:n_time) {
  x <- sample(1:n_states, 1, prob = ini.vec)
  obs.states[i] <- x
  obs.vec[i] = do.call(rnorm, listofnormals[[x]])
  ini.vec <- ini.vec %*% tran.m.true
}

obs.states
tran.m.true
```

```{r}
maxiter <- 500
N <- 5
Ti <- length(obs.vec)
epsilon <- 1e-5
pi.mar <- rep(1/N,N)
mean.vec <- c(2,3,9,10,12)
sd.vec <- c(1.5,2,3,4,2)
tran.m <- matrix(as.double(rep(1/N, N*N)), ncol = N, byrow = T)
system.time(BM1 <- BaumWelch_hmm(obs.vec, pi.mar, tran.m, mean.vec, sd.vec, maxiter, epsilon))
```


```{r}
plot(BM1$iter_LL)
```

